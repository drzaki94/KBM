<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBM TOOLKIT - First TCA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .input-field { background-color: #f8fafc; transition: all 0.2s; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.625rem; outline: none; width: 100%; }
        .input-field:focus { background-color: #ffffff; border-color: #0d9488; box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1); }
        .section-card { background-color: white; border-radius: 0.5rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); overflow: hidden; margin-bottom: 2rem; }
        .section-header { background-color: #f1f5f9; padding: 0.75rem 1.25rem; border-bottom: 1px solid #e2e8f0; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-slate-100 min-h-screen py-6 sm:py-10 px-4">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl overflow-hidden border border-slate-200">
        <div class="bg-teal-800 text-white p-6 sm:p-8 text-center">
            <h1 class="text-2xl sm:text-3xl font-extrabold uppercase tracking-wide">FIRST TCA KBM CLERKING SHEET</h1>
            <p class="text-teal-100 text-sm mt-2">Klinik Berhenti Merokok (KBM) - New Case Entry</p>
        </div>

        <div class="bg-slate-800 p-4 flex gap-2 no-print">
            <input type="text" id="searchIC" placeholder="Enter IC to Search Database..." class="flex-1 p-2 rounded text-sm outline-none">
            <button type="button" onclick="lookupIC()" class="bg-teal-500 text-white px-6 py-2 rounded text-sm font-bold hover:bg-teal-400 transition-all">üîç Search IC</button>
        </div>

        <form id="clerkingForm" class="p-6 sm:p-8">

            <section class="section-card">
                <div class="section-header"><h2 class="text-sm font-bold text-gray-600 uppercase">Patient Details</h2></div>
                <div class="p-5 grid grid-cols-1 md:grid-cols-2 gap-5 text-sm">
                    <div class="md:col-span-2"><label class="font-semibold text-gray-600">Name (Nama)</label><input type="text" id="ptName" class="input-field"></div>
                    <div><label class="font-semibold text-gray-600">IC Number</label><input type="text" id="ptIC" class="input-field font-mono"></div>
                    <div><label class="font-semibold text-gray-600">Gender</label><select id="gender" class="input-field"><option value="">Pilih</option><option value="Lelaki">Lelaki</option><option value="Perempuan">Perempuan</option></select></div>
                    <div><label class="font-semibold text-gray-600">Phone Number</label><input type="text" id="ptPhone" class="input-field font-mono"></div>
                    <div><label class="font-semibold text-gray-600">Referral From</label><input type="text" id="referral" class="input-field"></div>
                    <div class="md:col-span-2"><label class="font-semibold text-gray-600">Address</label><textarea id="ptAddress" rows="2" class="input-field"></textarea></div>
                </div>
            </section>

            <section class="section-card p-5 space-y-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3 uppercase">Medical Illness</label>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm">
                        <label class="flex items-center space-x-2"><input type="checkbox" class="med-illness" value="Asthma"> <span>Asthma</span></label>
                        <label class="flex items-center space-x-2"><input type="checkbox" class="med-illness" value="IHD"> <span>IHD</span></label>
                        <label class="flex items-center space-x-2"><input type="checkbox" class="med-illness" value="DM"> <span>DM</span></label>
                        <label class="flex items-center space-x-2"><input type="checkbox" class="med-illness" value="HPT"> <span>HPT</span></label>
                        <input type="text" id="illnessOthers" class="border-b outline-none text-sm col-span-2" placeholder="Others...">
                    </div>
                </div>
                <hr>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-3 uppercase">Smoking Type</label>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm">
                        <label class="flex items-center space-x-2"><input type="checkbox" class="smoke-type" value="Conventional"> <span>Conventional</span></label>
                        <label class="flex items-center space-x-2"><input type="checkbox" class="smoke-type" value="Vape"> <span>Vape</span></label>
                        <input type="text" id="smokeOthers" class="border-b outline-none text-sm col-span-2" placeholder="Others...">
                    </div>
                </div>
            </section>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <section class="bg-blue-50 rounded-lg border border-blue-100 p-5">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xs font-bold text-blue-900 uppercase">Cigarette (FTND)</h2><span id="scoreDisplay" class="font-bold text-blue-800 text-lg">0</span></div>
                    <div class="space-y-3 text-xs">
                        <select name="f1" onchange="calculateFagerstrom()" class="input-field py-1 text-xs"><option value="0">First cig after 60m [0]</option><option value="1">31-60m [1]</option><option value="2">6-30m [2]</option><option value="3">Within 5m [3]</option></select>
                        <div class="flex justify-between"><span>Forbidden places?</span><div class="space-x-2"><label><input type="radio" name="f2" value="1" onchange="calculateFagerstrom()"> Y</label><label><input type="radio" name="f2" value="0" checked onchange="calculateFagerstrom()"> N</label></div></div>
                        <div class="flex justify-between"><span>Hate to give up 1st?</span><div class="space-x-2"><label><input type="radio" name="f3" value="1" onchange="calculateFagerstrom()"> Y</label><label><input type="radio" name="f3" value="0" checked onchange="calculateFagerstrom()"> N</label></div></div>
                        <select name="f4" onchange="calculateFagerstrom()" class="input-field py-1 text-xs"><option value="0">10 or less [0]</option><option value="1">11-20 [1]</option><option value="2">21-30 [2]</option><option value="3">31+ [3]</option></select>
                        <div class="flex justify-between"><span>Smoke more in AM?</span><div class="space-x-2"><label><input type="radio" name="f5" value="1" onchange="calculateFagerstrom()"> Y</label><label><input type="radio" name="f5" value="0" checked onchange="calculateFagerstrom()"> N</label></div></div>
                        <div class="flex justify-between"><span>Smoke if ill in bed?</span><div class="space-x-2"><label><input type="radio" name="f6" value="1" onchange="calculateFagerstrom()"> Y</label><label><input type="radio" name="f6" value="0" checked onchange="calculateFagerstrom()"> N</label></div></div>
                        <p id="dependenceDisplay" class="text-blue-700 font-bold mt-2 text-center">(Very Low Dependence)</p>
                    </div>
                </section>
                <section class="bg-purple-50 rounded-lg border border-purple-100 p-5">
                    <div class="flex justify-between items-center mb-4"><h2 class="text-xs font-bold text-purple-900 uppercase">Vape Score (E-FTND)</h2><span id="vapeScoreDisplay" class="font-bold text-purple-800 text-lg">0</span></div>
                    <div class="space-y-4 text-xs">
                        <div><p class="font-semibold mb-1">Time to first vape after waking?</p><select name="v1" onchange="calculateVapeScore()" class="input-field py-1 text-xs"><option value="0">After 60m [0]</option><option value="1">31-60m [1]</option><option value="2">6-30m [2]</option><option value="3">Within 5m [3]</option></select></div>
                        <div class="flex justify-between items-center"><span>Difficult to stop in restricted?</span><div class="space-x-2"><label><input type="radio" name="v2" value="1" onchange="calculateVapeScore()"> Y</label><label><input type="radio" name="v2" value="0" checked onchange="calculateVapeScore()"> N</label></div></div>
                        <div><p class="font-semibold mb-1">Vaping sessions per day?</p><select name="v3" onchange="calculateVapeScore()" class="input-field py-1 text-xs"><option value="0">10 or less [0]</option><option value="1">11-20 [1]</option><option value="2">21-30 [2]</option><option value="3">31+ [3]</option></select></div>
                        <p id="vapeDepDisplay" class="text-purple-700 font-bold mt-2 text-center">(Low Dependence)</p>
                    </div>
                </section>
            </div>

            <section class="bg-orange-50 rounded-lg border border-orange-100 p-5 mb-8">
                <div class="flex justify-between items-center mb-4"><h2 class="text-lg font-bold text-orange-900 uppercase">ASSIST Score (Tobacco)</h2><span id="assistScoreDisplay" class="text-2xl font-bold text-orange-800">0</span></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs mb-4">
                    <div><p class="mb-1">1. Frequency of tobacco use (last 3 months)?</p><select name="a1" onchange="calculateAssist()" class="input-field text-xs"><option value="0">Never [0]</option><option value="3">Once/Twice [3]</option><option value="4">Monthly [4]</option><option value="5">Weekly [5]</option><option value="6">Daily [6]</option></select></div>
                    <div><p class="mb-1">2. Strong urge or desire to use?</p><select name="a2" onchange="calculateAssist()" class="input-field text-xs"><option value="0">Never [0]</option><option value="3">Once/Twice [3]</option><option value="4">Monthly [4]</option><option value="5">Weekly [5]</option><option value="6">Daily [6]</option></select></div>
                    <div><p class="mb-1">3. Health, social, or legal problems?</p><select name="a3" onchange="calculateAssist()" class="input-field text-xs"><option value="0">Never [0]</option><option value="4">Once/Twice [4]</option><option value="5">Monthly [5]</option><option value="6">Weekly [6]</option><option value="7">Daily [7]</option></select></div>
                    <div><p class="mb-1">4. Failed to do what was expected?</p><select name="a4" onchange="calculateAssist()" class="input-field text-xs"><option value="0">Never [0]</option><option value="5">Once/Twice [5]</option><option value="6">Monthly [6]</option><option value="7">Weekly [7]</option><option value="8">Daily [8]</option></select></div>
                    <div><p class="mb-1">5. Others expressed concern?</p><select name="a5" onchange="calculateAssist()" class="input-field text-xs"><option value="0">No [0]</option><option value="6">Yes, last 3 months [6]</option><option value="3">Yes, but not recently [3]</option></select></div>
                    <div><p class="mb-1">6. Failed to cut down/control use?</p><select name="a6" onchange="calculateAssist()" class="input-field text-xs"><option value="0">No [0]</option><option value="6">Yes, last 3 months [6]</option><option value="3">Yes, but not recently [3]</option></select></div>
                </div>
                <p id="assistInterpDisplay" class="text-orange-700 font-bold text-center text-sm border-t border-orange-200 pt-3">(Low Risk: Health feedback only)</p>
            </section>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <section class="section-card p-5">
                    <label class="text-xs font-bold uppercase text-gray-500 block mb-2">Smoking History & Pack Years</label>
                    <div class="grid grid-cols-2 gap-2"><input type="number" id="cigarettes" placeholder="Sticks/day" oninput="calculatePackYears()" class="input-field text-sm"><input type="number" id="smokingYears" placeholder="Years smoked" oninput="calculatePackYears()" class="input-field text-sm"></div>
                    <div class="mt-2 p-2 bg-slate-800 text-white rounded text-center text-xs font-bold">Pack Years: <span id="packYearsDisplay">0</span></div>
                </section>
                <section class="section-card p-5 text-center">
                    <label class="text-xs font-bold uppercase text-gray-500 block mb-2">CO Level (ppm)</label>
                    <input type="number" id="coLevel" class="input-field text-3xl font-bold text-teal-700 text-center" placeholder="0">
                </section>
            </div>

            <section class="section-card mb-8">
                <div class="bg-yellow-50 px-5 py-3 border-b border-yellow-200 uppercase font-bold text-yellow-900 text-sm">Pharmacotherapy</div>
                <div class="p-5">
                    <div class="flex items-center space-x-6 mb-4">
                        <label class="text-sm cursor-pointer"><input type="radio" name="pharmaOpt" value="no" checked onchange="togglePharma(false)"> No Medication</label>
                        <label class="text-sm cursor-pointer"><input type="radio" name="pharmaOpt" value="yes" onchange="togglePharma(true)"> Prescribe NRT</label>
                    </div>
                    <div id="pharmaDetailsDiv" class="hidden space-y-4 pt-4 border-t border-dashed">
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                            <label class="text-xs flex items-center space-x-2"><input type="checkbox" class="pharma-item" value="Gum 2mg"> <span>Nicorette Gum 2mg</span></label>
                            <label class="text-xs flex items-center space-x-2"><input type="checkbox" class="pharma-item" value="Gum 4mg"> <span>Nicorette Gum 4mg</span></label>
                            <label class="text-xs flex items-center space-x-2"><input type="checkbox" class="pharma-item" value="Patch 25mg"> <span>Nicorette Patch 25mg</span></label>
                            <label class="text-xs flex items-center space-x-2"><input type="checkbox" class="pharma-item" value="Patch 15mg"> <span>Nicorette Patch 15mg</span></label>
                            <label class="text-xs flex items-center space-x-2"><input type="checkbox" class="pharma-item" value="Patch 10mg"> <span>Nicorette Patch 10mg</span></label>
                        </div>
                        <input type="text" id="pharmaOther" placeholder="Additional dosage notes or other medications..." class="input-field text-xs">
                    </div>
                </div>
            </section>

            <section class="section-card p-5 mb-8">
                <label class="font-bold block mb-2 uppercase text-xs text-gray-500">Plan of Care (Behavioral Therapy)</label>
                <textarea id="plan" rows="3" class="input-field mb-6" placeholder="Identify triggers, behavioral strategies..."></textarea>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="font-bold text-gray-700 block mb-1 uppercase text-xs">Target Quit Date</label><input type="date" id="quitDate" class="input-field"></div>
                    <div><label class="font-bold text-gray-700 block mb-1 uppercase text-xs">Next Follow-up (TCA)</label><input type="date" id="tcaDate" class="input-field"></div>
                </div>
            </section>

            <input type="hidden" id="date">

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 no-print">
                <button type="button" onclick="saveToCloud()" id="saveBtn" class="bg-teal-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-teal-700 transition-all">‚òÅÔ∏è Save to Cloud</button>
                <button type="button" onclick="exportToWord()" class="bg-blue-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-all">üìù Save as Word</button>
                <button type="button" onclick="document.getElementById('clerkingForm').reset();" class="bg-white border-2 border-red-100 text-red-600 font-bold py-3 rounded-lg shadow-sm hover:bg-red-50">üóëÔ∏è Clear Form</button>
            </div>
        </form>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzsWZJxzV6bpSWgQLwdCKu9f-yJ8VUDKvL_uSPtsNlJ91c_jmtrrN3uAXfVQZuO9_CqWg/exec';

        window.onload = function() { document.getElementById('date').value = new Date().toISOString().split('T')[0]; };
        function togglePharma(s) { document.getElementById('pharmaDetailsDiv').classList.toggle('hidden', !s); }
        function calculatePackYears() {
            const c = parseFloat(document.getElementById('cigarettes').value) || 0;
            const y = parseFloat(document.getElementById('smokingYears').value) || 0;
            document.getElementById('packYearsDisplay').innerText = ((c/20)*y).toFixed(1);
        }

        function calculateFagerstrom() {
            let s = 0; s += parseInt(document.querySelector('select[name="f1"]').value) || 0;
            s += parseInt(document.querySelector('input[name="f2"]:checked')?.value) || 0;
            s += parseInt(document.querySelector('input[name="f3"]:checked')?.value) || 0;
            s += parseInt(document.querySelector('select[name="f4"]').value) || 0;
            s += parseInt(document.querySelector('input[name="f5"]:checked')?.value) || 0;
            s += parseInt(document.querySelector('input[name="f6"]:checked')?.value) || 0;
            document.getElementById('scoreDisplay').innerText = s;
            let d = (s <= 2) ? "Very Low Dependence" : (s <= 4) ? "Low Dependence" : (s <= 5) ? "Moderate Dependence" : (s <= 7) ? "High Dependence" : "Very High Dependence";
            document.getElementById('dependenceDisplay').innerText = "(" + d + ")";
        }

        function calculateVapeScore() {
            let s = 0; s += parseInt(document.querySelector('select[name="v1"]').value) || 0;
            s += parseInt(document.querySelector('input[name="v2"]:checked')?.value) || 0;
            s += parseInt(document.querySelector('select[name="v3"]').value) || 0;
            document.getElementById('vapeScoreDisplay').innerText = s;
            let d = (s <= 2) ? "Low Dependence" : (s <= 4) ? "Moderate Dependence" : "High Dependence";
            document.getElementById('vapeDepDisplay').innerText = "(" + d + ")";
        }

        function calculateAssist() {
            let s = 0;
            s += parseInt(document.querySelector('select[name="a1"]').value) || 0;
            s += parseInt(document.querySelector('select[name="a2"]').value) || 0;
            s += parseInt(document.querySelector('select[name="a3"]').value) || 0;
            s += parseInt(document.querySelector('select[name="a4"]').value) || 0;
            s += parseInt(document.querySelector('select[name="a5"]').value) || 0;
            s += parseInt(document.querySelector('select[name="a6"]').value) || 0;
            document.getElementById('assistScoreDisplay').innerText = s;
            let interp = (s <= 3) ? "Low Risk: Health feedback only" : (s <= 26) ? "Moderate Risk: Brief Intervention provided" : "High Risk: Intensive treatment or Referral";
            document.getElementById('assistInterpDisplay').innerText = "(" + interp + ")";
        }

        function getMulti(cls, id) { 
            let sel = []; document.querySelectorAll('.' + cls + ':checked').forEach(c => sel.push(c.value)); 
            if(id && document.getElementById(id).value) sel.push(document.getElementById(id).value); return sel.join(", "); 
        }

        async function lookupIC() {
            const ic = document.getElementById('searchIC').value;
            if (!ic) return alert("Please enter IC");
            try {
                const res = await fetch(`${SCRIPT_URL}?action=search&ic=${ic}`);
                const data = await res.json();
                if (data.found) {
                    document.getElementById('ptName').value = data.name;
                    document.getElementById('ptIC').value = ic;
                    document.getElementById('gender').value = data.gender;
                    document.getElementById('ptPhone').value = data.phone;
                    document.getElementById('ptAddress').value = data.address;
                    alert("Patient record found!");
                } else { alert("IC not found."); }
            } catch (e) { alert("Error connecting."); }
        }

        async function saveToCloud() {
            const btn = document.getElementById('saveBtn'); if(!document.getElementById('ptName').value) return alert("Sila isi Nama Pesakit!");
            btn.disabled = true; btn.innerText = "Connecting...";
            const p = new URLSearchParams();
            p.append('ptName', document.getElementById('ptName').value);
            p.append('ptIC', document.getElementById('ptIC').value);
            p.append('gender', document.getElementById('gender').value);
            p.append('ptPhone', document.getElementById('ptPhone').value);
            p.append('ptAddress', document.getElementById('ptAddress').value);
            p.append('referral', document.getElementById('referral').value);
            p.append('medicalIllness', getMulti('med-illness', 'illnessOthers'));
            p.append('smokingType', getMulti('smoke-type', 'smokeOthers'));
            p.append('date', document.getElementById('date').value);
            p.append('quitDate', document.getElementById('quitDate').value);
            p.append('fagerstromScore', document.getElementById('scoreDisplay').innerText);
            p.append('fagerstromDep', document.getElementById('dependenceDisplay').innerText);
            p.append('vapeScore', document.getElementById('vapeScoreDisplay').innerText);
            p.append('vapeDep', document.getElementById('vapeDepDisplay').innerText);
            p.append('assistScore', document.getElementById('assistScoreDisplay').innerText);
            p.append('assistInterp', document.getElementById('assistInterpDisplay').innerText);
            p.append('cigarettesPerDay', document.getElementById('cigarettes').value);
            p.append('smokingYears', document.getElementById('smokingYears').value);
            p.append('packYears', document.getElementById('packYearsDisplay').innerText);
            p.append('coLevel', document.getElementById('coLevel').value);
            p.append('plan', document.getElementById('plan').value);
            p.append('pharma', getMulti('pharma-item', 'pharmaOther'));
            p.append('tcaDate', document.getElementById('tcaDate').value);

            try {
                await fetch(SCRIPT_URL + "?" + p.toString(), { method: 'GET', mode: 'no-cors' });
                alert("Data Berjaya Disimpan ke Cloud!");
            } catch (e) { alert("Error saving data."); }
            finally { btn.disabled = false; btn.innerText = "‚òÅÔ∏è Save to Cloud"; }
        }

        function exportToWord() {
            const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
            const n = document.getElementById('ptName').value || "Unnamed";
            const doc = new Document({
                sections: [{
                    children: [
                        new Paragraph({ text: "KBM CLERKING REPORT", heading: HeadingLevel.HEADING_1, alignment: AlignmentType.CENTER }),
                        new Paragraph({ text: "" }),
                        new Paragraph({ children: [new TextRun({ text: "1. PATIENT INFORMATION", bold: true, underline: true })] }),
                        new Paragraph({ text: `Name: ${n} | IC: ${document.getElementById('ptIC').value}` }),
                        new Paragraph({ text: `Gender: ${document.getElementById('gender').value} | Phone: ${document.getElementById('ptPhone').value}` }),
                        new Paragraph({ text: `Address: ${document.getElementById('ptAddress').value}` }),
                        new Paragraph({ text: `Medical History: ${getMulti('med-illness', 'illnessOthers')}` }),
                        new Paragraph({ text: `Type of Smoking: ${getMulti('smoke-type', 'smokeOthers')}` }),
                        new Paragraph({ text: "" }),
                        new Paragraph({ children: [new TextRun({ text: "2. CLINICAL DATA (CIGARETTE)", bold: true, underline: true })] }),
                        new Paragraph({ text: `Sticks per Day: ${document.getElementById('cigarettes').value || "0"} sticks` }),
                        new Paragraph({ text: `Total Years Smoked: ${document.getElementById('smokingYears').value || "0"} years` }),
                        new Paragraph({ text: `Pack Years: ${document.getElementById('packYearsDisplay').innerText}` }),
                        new Paragraph({ text: `Exhaled CO Level: ${document.getElementById('coLevel').value || "0"} ppm` }),
                        new Paragraph({ text: "" }),
                        new Paragraph({ children: [new TextRun({ text: "3. ADDICTION ASSESSMENTS", bold: true, underline: true })] }),
                        new Paragraph({ text: `Cigarette Score (FTND): ${document.getElementById('scoreDisplay').innerText} ${document.getElementById('dependenceDisplay').innerText}` }),
                        new Paragraph({ text: `Vape Score (E-FTND): ${document.getElementById('vapeScoreDisplay').innerText} ${document.getElementById('vapeDepDisplay').innerText}` }),
                        new Paragraph({ text: `ASSIST Score (Tobacco): ${document.getElementById('assistScoreDisplay').innerText} ${document.getElementById('assistInterpDisplay').innerText}` }),
                        new Paragraph({ text: "" }),
                        new Paragraph({ children: [new TextRun({ text: "4. MANAGEMENT PLAN", bold: true, underline: true })] }),
                        new Paragraph({ text: `Target Quit Date: ${document.getElementById('quitDate').value || "Not set"}` }),
                        new Paragraph({ text: `Pharmacotherapy: ${getMulti('pharma-item', 'pharmaOther') || "Behavioral counseling only"}` }),
                        new Paragraph({ text: `Plan of Care: ${document.getElementById('plan').value || "Behavioral goal-setting provided"}` }),
                        new Paragraph({ text: `Next Follow-up (TCA): ${document.getElementById('tcaDate').value || "Not set"}` }),
                    ],
                }],
            });
            Packer.toBlob(doc).then(b => { saveAs(b, `KBM_Clerking_${n}.docx`); });
        }
    </script>
</body>
</html>